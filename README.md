# leagues-cup-2023
Estimates team strength parameters for all MLS and Liga MX teams in 2023 using all data from 2023 up to 8/15/23 (will be updated when Leagues Cup concludes). The model used to estimate team strength parameters models goals scored by the home and away teams of each match as having a bivariate Poisson distribution, which is derived as the product of two Poisson marginal distibutions with a multiplicative factor. The modeling used here allows for the correlation of goals scored between home and away team to be positive, zero, or negative. For theoretical details, see 

Lakshminarayana, J., Pandit, S., and Srinivasa Rao, K. (1999). On a Bivariate Poisson Distribution. Communications in Statistics - Theory and Methods, 28:267–276.
https://www.tandfonline.com/doi/abs/10.1080/03610929908832297

The model was estimated using Stata's _bivcnto_ command with the _pfamoye_ option. For details, see

Xu, X. and Hardin, J. W. (2016). Regression models for bivariate count outcomes. The Stata Journal, 16(2):301–315.
https://journals.sagepub.com/doi/pdf/10.1177/1536867X1601600203

# Organization of Files

## data

All data is in the "data" folder, which contains two subfolders.

### raw

The subfolder "raw" contains all raw data used as inputs to the model. These include

1. _MLS games.dta_ - game data from 2023 MLS Regular Season prior to Leagues Cup
2. _Liga MX.dta_ - game data from 2023 Liga MX Clausura 
3. _Leagues Cup.dta_ - game data from all 2023 Leagues Cup games (updated 8.16.23)
4. _logos_ folder - logo image files for all teams
5. _logos.xlsx_ - bridge for team names and logo image files

### output

The subfolder "output" is where all output (data and images) will be saved. The folder currently has all files that the code will create when all do-files and R files are run. 

1. _game data.dta_ - full data set for analysis generated by _data prep.do_
2. _coefficients.xlsx_ - team strength coefficients generated by _bivariate Poisson.do_
3. _Monterrey at New England.jpg_ - outcome probability chart generated by _bivariate Poisson.do_
4. _New England at Monterrey.jpg_ - outcome probability chart generated by _bivariate Poisson.do_

# do files

Contains both do-files needed to estimate team strength parameters and create match outcome probability charts for matches between the top teams in MLS and Liga MX.  

1. _data prep.do_ - takes the raw data and generates the full data set for analysis, _game data.dta_.
2. _bivariate Poisson.do_ - estimates team strength parameters from _game data.dta_, generates _coefficients.xlsx_ to be used in _bar chart.R_, and generates outcome probability charts for home/away games between top team in each league (_Monterrey at New England.jpg_ and _New England at Monterrey.jpg_)

# R files

Contains the R script that creates the rankings of teams as horizontal bar charts using team logos.

1. _bar chart.R_ - generates horizontal bar charts of team strengths from _coefficients.xlsx_. Image files must be saved manually.

# Order of Operations
To reproduce the results of my SubStackm article "Comparable Rankings of MLS and Liga MX Teams" (still in draft as of this README.md draft), follow this order of operations
   
1. run _data prep.do_ in Stata (change file paths to location of data folder on your computer)
2. run _bivariate Poisson.do_ in Stata (change file paths to location of data folder on your computer)
3. run _bar chart.R_ in R (change file paths to location of data folder on your computer)
4. Let me know if you have any issues with steps 1-3
